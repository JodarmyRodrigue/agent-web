<!DOCTYPE html>
<html>

<head>
  <title><%= title %></title>
  <%- include('../blocks/stylesheets'); %> 
</head>

<body>
  <%- include('../blocks/navbar'); %> 

  <div class="content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 30px 60px; height: 100%;">
    <h1><%= title %></h1>
    <form id="updateAccountForm">
        <div class="form-group">
          <label for="username">Nom d'utilisateur</label>
          <input name="username" type="text" class="form-control" id="username" placeholder="Placeholder">
        </div>
        
        <div class="form-group">
            <label for="email">Adresse Email</label>
            <input name="email" type="email" class="form-control" id="email" placeholder="Placeholder">
          </div>
          <div class="form-group">
            <label for="password">Mot de passe</label>
            <input name="password" type="password" class="form-control" id="password" required>
          </div>
          <div class="form-group">
            <label for="password2">Confirmez votre mot de passe</label>
            <input type="password" class="form-control" id="password2" required>
          </div>
          <div class="form-group">
            <label for="occupation">Votre Poste</label>
            <input name="occupation" type="text" class="form-control" id="occupation" placeholder="Placeholder">
          </div>
        <button id="updateAccountSubmit" type="submit" class="btn btn-primary">Changer</button>
      </form>
  </div>

  <script>
    let $updateAccountForm = document.querySelector('#updateAccountForm');
    let $updateAccountSubmit = document.querySelector('#updateAccountSubmit');

    let $password = document.querySelector('#password');
    let $password2 = document.querySelector('#password2');
   
    $updateAccountSubmit.addEventListener('click', (event) => {
      event.preventDefault();

      if($password.value != $password2.value){
        alert('Vos mots de passe ne correspondent pas');
        return;
      }

      let formData = new FormData($updateAccountForm);
      let body = {};


      for (const [key, value] of formData.entries()) {
        body[key] = value;
      }

      axios.post('/dashboard/account', body)
        .then(response => {
          alert('Données changées avec succès!');
          window.location = "/dashboard/account";
        }).catch(error => {
          if (error.response) {
            console.dir(error.response);
            if (error.response.status === 400) {
              alert(error.response.data.message);
            } else if (error.response.status === 403) {
              alert('INTERDIT');
            } else if (error.response.status === 404) {
              alert('INTROUVABLE');
            }
          } else if (error.request) {
            console.dir(error.request);
          } else {
            console.dir(error);
          }
        }).finally(() => {

        });

    });
  </script>

  <%- include('../blocks/javascripts'); %> 
</body>

</html>